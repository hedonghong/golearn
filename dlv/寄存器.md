
## 寄存器名称

```go
1、通用寄存器：rax, rbx, rcx, rdx, rsi, rdi, rbp, rsp, r8, r9, r10, r11, r12, r13, r14, r15寄存器。CPU对这16个通用寄存器的用途没有做特殊规定，程序员和编译器可以自定义其用途（下面会介绍，rsp/rbp寄存器其实是有特殊用途的）；

2、程序计数寄存器（PC寄存器，有时也叫IP寄存器）：rip寄存器。它用来存放下一条即将执行的指令的地址，这个寄存器决定了程序的执行流程；
    
    rip寄存器里面存放的是CPU即将执行的下一条指令在内存中的地址。看如下汇编语言代码片段：
    
    0x0000000000400770:    add %rdx,%rax
    0x0000000000400773:    mov $0x0,%ecx
    假设当前CPU正在执行第一条指令，这条指令在内存中的地址是0x0000000000400770，紧接它后面的下一条指令的地址是0x0000000000400773，所以此时rip寄存器里面存放的值是0x0000000000400773。
    
    这里需要牢记的就是rip寄存器的值不是正在被CPU执行的指令在内存中的地址，而是紧挨这条正在被执行的指令后面那一条指令的地址。
    其实修改rip寄存器的值是CPU自动控制的，不需要我们用指令去修改，当然CPU也提供了几条可以间接修改rip寄存器的指令，在汇编语言一节中我们会详细介绍CPU自动修改以及用指令修改rip寄存器值的两种方式。


3、段寄存器：fs和gs寄存器。一般用它来实现线程本地存储（TLS），比如AMD64 linux平台下go语言和pthread都使用fs寄存器来实现系统线程的TLS，在本章线程本地存储一节和第二章详细分析goroutine调度器的时候我们可以分别看到Linux平台下Pthread线程库和go是如何使用fs寄存器的。
```

## rsp 栈顶寄存器和rbp栈基址寄存器

```go
    这两个寄存器都跟函数调用栈有关，其中rsp寄存器一般用来存放函数调用栈的栈顶地址，而rbp寄存器通常用来存放函数的栈帧起始地址，编译器一般使用这两个寄存器加一定偏移的方式来访问函数局部变量或函数参数，比如：
    
    mov 0x8(%rsp),%rdx

    这条指令把地址为 0x8(%rsp) 的内存中的值拷贝到rdx寄存器，这里的0x8(%rsp) 就利用了 rsp 寄存器加偏移 8 的方式来读取内存中的值。
```

## 存储模式

大端存储模式：数据的高字节保存在内存的低地址中，低字节保存在内存的高地址中。
小端存储模式：数据的高字节保存在内存的高地址中，低字节保存在内存的低地址中。

整数0x1122334455667788存储模式

| 大端存储模式|地址|小端存储模式|
| ----------- | ----------- |-----------|
|0x88|X+7|0x11
|0x77|X+6|0x22
|0x66|X+5|0x33
|0x55|X+4|0x44
|0x44|X+3|0x55
|0x33|X+2|0x66
|0x22|X+1|0x77
|0x11|X(起始)|0x88

## golang中栈和堆的内存分布

|高地址|
| ----------- |
|内核|
|栈起|
|栈↓|
|栈终点|
||
|内存|
||
|堆终点|
|堆↑|
|堆起点|
|全局数据|
|代码|
|系统保留未用|
|低地址|

栈作用

被用来：
1、保存函数的局部变量；

2、向被调用函数传递参数；

3、返回函数的返回值；

4、保存函数的返回地址。返回地址是指从被调用函数返回后调用者应该继续执行的指令地址，在汇编指令一节介绍call指令时我们将会对返回地址做更加详细的说明。

    假如有三个函数调用
    
    A()->B()->C()

    则函数ABC的栈

|--|栈底（高地址）|
|-----------| ----------- |
|-|返回地址|
|A函数的栈帧|函数A的局部变量<br>函数B的返回值<br>传递给B的参数<br>B函数的执行完之后返回A的地址|
|B函数的栈帧|函数B的局部变量<br>函数C的返回值<br>传递给C的参数<br>C函数的执行完之后返回B的地址|
|C函数的栈帧|函数B的局部变量|

最新的rbp 在C函数的栈底，rsp在C函数的栈顶，寄存器rbp和rsp始终指向正在执行的函数的栈帧，go语言中函数的参数和返回值都是放在栈上的，但在1.17版本后发生改变了，类似C语言，这也叫函数的调用规约


