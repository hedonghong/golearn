
进程崩溃解决方案

1、WAL 预写日志
    每个状态的改变，当作一个命令记录在硬盘上的一个追加的文件上。


网络延迟

问题：
1、一个特定的服务器不能为了知晓其他服务器是否已经崩溃而无限等待。
2、不应该有两组服务器，认为彼此失效，继续为不同的客户端提供服务，这是脑裂。

上述问题解决方案：

1、定期心跳
2、多数论，比如5台服务器，必须要有3台服务器支持才能启动服务。数量为一半的服务器+1，
占多数的服务器的数量称为 Quorum，5的Quorum=3
使用领导者和追随者控制日志的更新，使用高水位标记日志同步情况，比如kafka。
高水位标记（High Water Mark）用于追踪在 WAL 上的项是否已经成功复制到 Quorum 的追随者上。所有达到高水位标记的条目就会对客户端可见。领导者还会将高水位标记传播给追随者

进程暂停

1、即使有了Quorum也会有进程暂停的情况，领导者的因为长时间垃圾回收暂停了，追随者失联重新选举。
但是在领导恢复后会对追随者发消息，这时需要判断请求是否来自过期的领导者，世代时钟就是用于标记和检测请求是否来自原领导的。一般 世代，就是一个单调递增的数字

不同步的时钟和定序问题

检测消息是来自原有的领导者还是新的领导者，这个问题是一个维护消息顺序的问题。一种显而易见的解决方案是，采用系统时间戳为一组消息定序，但是，我们不能这么做。主要原因在于，跨服务器使用系统时钟是无法保证同步的。跨服务器同步时钟，可以使用一种称为 NTP 的服务。网络延迟可能会有很大差异，由于网络原因，时钟同步可能会造成延迟。这就会造成服务器时钟彼此偏移，经过 NTP 同步之后，甚至会出现时间倒退。因为这些计算机时钟存在的问题，时间通常是不能用于对事件定序。取而代之的是，可以使用一种简单的技术，称为 Lamport 时间戳。 世代时钟就是其中一种。

